# GPU Troubleshooting Guide

This guide will help you resolve common issues with GPU acceleration for TensorFlow.

## Testing GPU Availability

First, run the GPU test script to check if your GPU is properly configured:

```bash
python test_gpu.py
```

For CUDA 12.8 compatibility testing, use:

```bash
python verify_cuda12_setup.py
```

## CUDA 12.8 and cuDNN 9.7.1 Compatibility

If you have CUDA 12.8 and cuDNN 9.7.1 installed (newer than what's typically recommended for TensorFlow 2.9.0), follow these steps:

1. Run the compatibility checker:
   ```bash
   python setup_cuda_compatibility.py
   ```

2. Update TensorFlow to a compatible version:
   ```bash
   pip uninstall tensorflow tensorflow-gpu
   pip install tensorflow==2.17.0
   ```

3. Verify your setup:
   ```bash
   python verify_cuda12_setup.py
   ```

## Common Issues and Solutions

### 1. TensorFlow doesn't detect the GPU

If TensorFlow doesn't detect your GPU, check the following:

#### Check if you have a CUDA-compatible GPU

Run this command to see if you have a CUDA-compatible NVIDIA GPU:

```bash
nvidia-smi
```

If this command fails or doesn't show your GPU, you may need to:
- Install NVIDIA drivers
- Make sure your GPU is CUDA-compatible (check NVIDIA's list of CUDA-enabled GPUs)

#### Check TensorFlow installation

Make sure you have the GPU version of TensorFlow installed:

```bash
pip install tensorflow
```

For newer versions of TensorFlow (2.1+), the base package includes GPU support, but you still need CUDA and cuDNN.

### 2. CUDA and cuDNN Issues

Different TensorFlow versions require specific CUDA and cuDNN versions:

| TensorFlow Version | CUDA Version | cuDNN Version |
|--------------------|--------------|--------------|
| 2.9.0              | 11.2         | 8.1.0        |
| 2.10.0 - 2.11.0    | 11.2         | 8.1.0        |
| 2.12.0 - 2.13.0    | 11.8         | 8.6.0        |
| 2.14.0 - 2.15.0    | 11.8         | 8.7.0        |
| 2.16.0 - 2.17.0    | 12.3         | 8.9.0        |

For CUDA 12.8 and cuDNN 9.7.1, TensorFlow 2.16.0 or 2.17.0 is recommended.

#### Setting Environment Variables for CUDA 12.8

**Windows:**
```
SET PATH=C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v12.5\bin;%PATH%
SET PATH=C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v12.5\extras\CUPTI\lib64;%PATH%
SET PATH=C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v12.5\include;%PATH%
```

**Linux/macOS:**
```bash
export PATH=/usr/local/cuda-12.8/bin${PATH:+:${PATH}}
export LD_LIBRARY_PATH=/usr/local/cuda-12.8/lib64${LD_LIBRARY_PATH:+:${LD_LIBRARY_PATH}}
```

### 3. Out of Memory Errors

If you encounter "Out of Memory" errors:

1. Reduce batch size in `main.py`:
   ```python
   batch_size = 64  # Try a smaller value like 32 or 16
   ```

2. Reduce model complexity in `model/cnn_model.py`

3. Enable memory growth (already implemented in the code):
   ```python
   tf.config.experimental.set_memory_growth(device, True)
   ```

4. Limit GPU memory usage:
   ```python
   tf.config.set_logical_device_configuration(
       gpus[0],
       [tf.config.LogicalDeviceConfiguration(memory_limit=4096)]  # Limit to 4GB
   )
   ```

### 4. Slow GPU Performance

If your GPU is detected but performance is slow:

1. Check if other processes are using the GPU:
   ```bash
   nvidia-smi
   ```

2. Close other GPU-intensive applications

3. Update GPU drivers to the latest version

4. Increase batch size (if memory allows) for better parallelization

5. Enable mixed precision training (already implemented in the code)

## Verifying GPU Usage

To verify that your model is actually using the GPU during training:

1. Check the output of `nvidia-smi` while training is running
2. Look for the GPU usage graph generated by the training process (`gpu_usage.png`)
3. Compare training times between CPU and GPU using the test script

## Additional Resources

- [TensorFlow GPU Support](https://www.tensorflow.org/install/gpu)
- [NVIDIA CUDA Installation Guide](https://docs.nvidia.com/cuda/cuda-installation-guide-microsoft-windows/index.html)
- [cuDNN Installation Guide](https://docs.nvidia.com/deeplearning/cudnn/install-guide/index.html)
- [TensorFlow-CUDA Compatibility Matrix](https://www.tensorflow.org/install/source#gpu) 